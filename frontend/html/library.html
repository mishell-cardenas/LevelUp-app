<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LevelUp - My Library</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/library.css" />
  </head>
  <body>
    <!-- Stars Background -->
    <canvas class="stars-canvas" id="starsCanvas"></canvas>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">LevelUp</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <span class="nav-link user-greeting" id="userGreeting"
                >Welcome</span
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="library.html">My Library</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="logoutBtn">Logout</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="container py-5">
      <!-- Page Title -->
      <h1 class="page-title mb-4" data-text="User's Library">User's Library</h1>

      <!-- Filter Section -->
      <div class="filter-section mb-4">
        <div class="filter-group">
          <label for="statusFilter">Status:</label>
          <select id="statusFilter" class="filter-select">
            <option value="">All</option>
            <option value="Playing">Playing</option>
            <option value="Completed">Completed</option>
            <option value="On Hold">On Hold</option>
            <option value="Dropped">Dropped</option>
            <option value="Wishlist">Wishlist</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="sortBy">Sort by:</label>
          <select id="sortBy" class="filter-select">
            <option value="recent">Recently Added</option>
            <option value="title">Title</option>
            <option value="rating">Rating</option>
            <option value="progress">Progress</option>
          </select>
        </div>
      </div>

      <!-- Library Grid -->
      <div class="library-grid" id="libraryGrid">
        <!-- Games rendered dynamically by library.js -->
      </div>

      <!-- Floating Add Button -->
      <button class="fab" id="addGameBtn" title="Add Game">
        <span>+</span>
      </button>
    </main>

    <!-- Game Detail Modal -->
    <div class="modal-overlay" id="gameModal">
      <div class="game-modal glass-card">
        <button class="modal-close" onclick="closeGameModal()">&times;</button>
        <div class="modal-content-grid">
          <div class="modal-cover">
            <img id="modalCover" src="" alt="Game Cover" />
          </div>
          <div class="modal-details">
            <h2 id="modalTitle" class="modal-game-title">Game Title</h2>

            <div class="detail-row">
              <span class="detail-label">Status</span>
              <select id="modalStatus" class="form-input">
                <option value="Wishlist">Wishlist</option>
                <option value="Playing">Playing</option>
                <option value="On Hold">On Hold</option>
                <option value="Completed">Completed</option>
                <option value="Dropped">Dropped</option>
              </select>
            </div>

            <div class="detail-row">
              <span class="detail-label">Completion</span>
              <input
                type="number"
                id="modalCompletion"
                class="form-input"
                min="0"
                max="100"
                value="0"
              />
            </div>

            <div class="detail-row">
              <span class="detail-label">Priority</span>
              <select id="modalPriority" class="form-input">
                <option value="">None</option>
                <option value="1">1 - Highest</option>
                <option value="2">2 - High</option>
                <option value="3">3 - Medium</option>
                <option value="4">4 - Low</option>
                <option value="5">5 - Lowest</option>
              </select>
            </div>

            <div class="detail-row">
              <span class="detail-label">Platform</span>
              <select id="modalPlatform" class="form-input">
                <option value="Steam">Steam</option>
                <option value="PlayStation">PlayStation</option>
                <option value="Xbox">Xbox</option>
                <option value="Nintendo Switch">Nintendo Switch</option>
                <option value="PC (Other)">PC (Other)</option>
              </select>
            </div>

            <div
              style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px"
            >
              <button class="btn-primary-gradient" onclick="saveGame()">
                Save Changes
              </button>
              <button class="btn-primary-gradient" onclick="openJournal()">
                Open Journal
              </button>
              <button
                class="btn-small btn-danger"
                onclick="deleteGame()"
                style="margin-left: auto"
              >
                Delete
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Game Modal -->
    <div class="modal-overlay" id="addGameModal">
      <div class="add-game-modal glass-card">
        <button class="modal-close" onclick="closeAddGameModal()">
          &times;
        </button>
        <h2 class="modal-title">Add Game to Library</h2>

        <form id="addGameForm">
          <div class="form-group" style="position: relative">
            <label for="gameName">Game Name *</label>
            <input
              type="text"
              id="gameName"
              class="form-input"
              placeholder="Search for a game..."
              autocomplete="off"
              required
            />
            <div
              id="gameSearchResults"
              style="
                display: none;
                position: absolute;
                z-index: 10;
                width: 100%;
                max-height: 200px;
                overflow-y: auto;
                background: #1a1a2e;
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 8px;
                margin-top: 2px;
              "
            ></div>
            <input type="hidden" id="gameSteamId" />
            <input type="hidden" id="gameHeaderImage" />
          </div>

          <div class="form-group">
            <label for="gameStatus">Status</label>
            <select id="gameStatus" class="form-input">
              <option value="Wishlist">Wishlist</option>
              <option value="Playing">Playing</option>
              <option value="On Hold">On Hold</option>
              <option value="Completed">Completed</option>
              <option value="Dropped">Dropped</option>
            </select>
          </div>

          <div class="form-group">
            <label for="gamePlatform">Platform</label>
            <select id="gamePlatform" class="form-input">
              <option value="Steam">Steam</option>
              <option value="PlayStation">PlayStation</option>
              <option value="Xbox">Xbox</option>
              <option value="Nintendo Switch">Nintendo Switch</option>
              <option value="PC (Other)">PC (Other)</option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="gamePriority">Priority</label>
              <select id="gamePriority" class="form-input">
                <option value="">None</option>
                <option value="1">1 - Highest</option>
                <option value="2">2 - High</option>
                <option value="3">3 - Medium</option>
                <option value="4">4 - Low</option>
                <option value="5">5 - Lowest</option>
              </select>
            </div>

            <div class="form-group">
              <label for="gameProgress">Progress %</label>
              <input
                type="number"
                id="gameProgress"
                class="form-input"
                min="0"
                max="100"
                value="0"
              />
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn-secondary"
              onclick="closeAddGameModal()"
            >
              Cancel
            </button>
            <button type="submit" class="btn-primary-gradient">Add Game</button>
          </div>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/stars.js"></script>
    <script src="/js/library.js"></script>
  </body>
</html>
